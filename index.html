<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²æ–™ç´€éŒ„åæŸ¥ç³»çµ± v2.1</title>
    <style>
        :root { --primary-color: #27ae60; --danger-color: #e74c3c; --accent-color: #f1c40f; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: #f4f6f8; padding: 15px; margin: 0; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: #333; margin-top: 0; }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 14px; color: #666; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        input:focus { border-color: var(--primary-color); outline: none; }
        .row { display: flex; gap: 10px; }
        button { width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; margin-top: 10px; box-shadow: 0 4px 6px rgba(39,174,96,0.2); }
        
        /* æœå°‹åæŸ¥å€ */
        .search-section { margin-top: 30px; border-top: 2px dashed #eee; padding-top: 20px; }
        .search-box { background-color: #fff9e6; border: 2px solid var(--accent-color); font-weight: bold; }
        
        /* ç´€éŒ„å¡ç‰‡ */
        .record-list { margin-top: 15px; }
        .record-item { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 12px; border: 1px solid #eee; position: relative; }
        .record-item.good { border-left: 8px solid var(--primary-color); }
        .record-item.bad { border-left: 8px solid var(--danger-color); }
        .item-title { font-weight: bold; font-size: 18px; color: #111; }
        .item-info { font-size: 14px; color: #555; margin-top: 3px; }
        .item-note { font-size: 13px; color: #777; background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 8px; border-left: 2px solid #ddd; }
        .delete-btn { position: absolute; right: 12px; top: 12px; color: #ccc; cursor: pointer; font-size: 12px; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; background: #eee; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¥¤ é£²æ–™é–‹ç™¼ç­†è¨˜</h2>
    
    <div class="form-group"><label>é£²æ–™åº—</label><input type="text" id="shopName" placeholder="ä¾‹å¦‚ï¼šéº»å¤ã€å¯ä¸å¯"></div>
    <div class="form-group"><label>åœ°é»</label><input type="text" id="location" placeholder="ä¾‹å¦‚ï¼šä¸‰é‡è‡ªå¼·åº—"></div>
    <div class="form-group"><label>å“é …</label><input type="text" id="drinkName" placeholder="ä¾‹å¦‚ï¼šé‡‘è±é›™Q"></div>
    
    <div class="row">
        <div class="form-group" style="flex:1.2">
            <label>ç”œåº¦</label>
            <select id="sugar">
                <option value="ç„¡ç³–">ç„¡ç³–</option>
                <option value="ä¸€åˆ†ç³–" selected>ä¸€åˆ†ç³–</option>
                <option value="å¾®ç³–(3åˆ†)">å¾®ç³–(3åˆ†)</option>
                <option value="åŠç³–(5åˆ†)">åŠç³–(5åˆ†)</option>
                <option value="å°‘ç³–(7åˆ†)">å°‘ç³–(7åˆ†)</option>
                <option value="æ­£å¸¸ç³–">æ­£å¸¸ç³–</option>
            </select>
        </div>
        <div class="form-group" style="flex:1">
            <label>å†°å¡Š</label>
            <select id="ice">
                <option value="å¾®å†°">å¾®å†°</option>
                <option value="å°‘å†°">å°‘å†°</option>
                <option value="å»å†°">å»å†°</option>
                <option value="æ­£å¸¸">æ­£å¸¸</option>
                <option value="ç†±">ç†±</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label>è©•åƒ¹</label>
        <select id="rating">
            <option value="ğŸ‘ å¥½å–">ğŸ‘ å¥½å–ï¼Œä¸‹æ¬¡å†é»</option>
            <option value="ğŸ‘ è¸©é›·">ğŸ‘ é›£å–ï¼Œåƒè¬åˆ¥é»</option>
        </select>
    </div>

    <div class="form-group"><label>å‚™è¨»å¿ƒå¾—</label><textarea id="note" rows="2" placeholder="å¥½å–åœ¨å“ªï¼Ÿçç  Q å—ï¼Ÿ"></textarea></div>

    <button id="saveBtn" onclick="saveRecord()">å„²å­˜ç´€éŒ„ä¸¦ä¸Šå‚³é›²ç«¯</button>

    <div class="search-section">
        <label>ğŸ” å¿«é€ŸåæŸ¥æ­·å² (è¼¸å…¥é—œéµå­—)</label>
        <input type="text" id="searchInput" class="search-box" placeholder="æœå°‹åº—åã€å“é …æˆ–å‚™è¨»..." onkeyup="displayRecords()">
        
        <div id="recordList" class="record-list">
            </div>
    </div>
</div>

<script>
    // --- è²¼ä¸Šä½ çš„ Google Apps Script URL ---
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwWzUhwBnoYacz-Ncj0npr1ZpKPc7eXqiL6DLJcGsl93URkQkBnL5uSirAGydxcHPVMYw/exec"; 

    window.onload = displayRecords;

    async function saveRecord() {
        const btn = document.getElementById('saveBtn');
        const record = {
            shop: document.getElementById('shopName').value,
            loc: document.getElementById('location').value,
            drink: document.getElementById('drinkName').value,
            sugar: document.getElementById('sugar').value,
            ice: document.getElementById('ice').value,
            rating: document.getElementById('rating').value,
            note: document.getElementById('note').value,
            date: new Date().toLocaleDateString()
        };

        if(!record.shop || !record.drink) return alert('è«‹å¡«å¯«åº—åèˆ‡å“é …');

        btn.disabled = true;
        btn.innerText = "é€£ç·šé›²ç«¯ä¸­...";

        // é›²ç«¯åŒæ­¥
        if(WEB_APP_URL !== "åœ¨æ­¤è²¼ä¸Šä½ çš„GASç¶²å€") {
            try {
                await fetch(WEB_APP_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(record) });
            } catch (e) { console.error("é›²ç«¯åŒæ­¥å¤±æ•—"); }
        }

        // æœ¬åœ°å„²å­˜
        let records = JSON.parse(localStorage.getItem('myDrinkLogs') || '[]');
        record.id = Date.now();
        records.unshift(record);
        localStorage.setItem('myDrinkLogs', JSON.stringify(records));

        // é‡ç½® UI
        document.getElementById('drinkName').value = '';
        document.getElementById('note').value = '';
        displayRecords();
        btn.disabled = false;
        btn.innerText = "å„²å­˜ç´€éŒ„ä¸¦ä¸Šå‚³é›²ç«¯";
        alert('å„²å­˜æˆåŠŸï¼');
    }

    function displayRecords() {
        const list = document.getElementById('recordList');
        const term = document.getElementById('searchInput').value.toLowerCase();
        const records = JSON.parse(localStorage.getItem('myDrinkLogs') || '[]');
        
        const filtered = records.filter(item => 
            item.shop.toLowerCase().includes(term) || 
            item.drink.toLowerCase().includes(term) || 
            item.note.toLowerCase().includes(term)
        );

        list.innerHTML = '';
        if (filtered.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#999; margin-top:20px;">å°šç„¡ç›¸ç¬¦ç´€éŒ„</div>';
            return;
        }

        filtered.forEach(item => {
            const isBad = item.rating.includes('ğŸ‘');
            const div = document.createElement('div');
            div.className = `record-item ${isBad ? 'bad' : 'good'}`;
            div.innerHTML = `
                <span class="delete-btn" onclick="deleteRecord(${item.id})">åˆªé™¤</span>
                <div class="item-title">${item.drink}</div>
                <div class="item-info">ğŸ“ ${item.shop} <span style="color:#999">(${item.loc})</span></div>
                <div style="margin-top:5px;">
                    <span class="tag">${item.sugar}</span>
                    <span class="tag">${item.ice}</span>
                    <span class="tag">${item.rating}</span>
                </div>
                ${item.note ? `<div class="item-note">${item.note}</div>` : ''}
                <div style="font-size: 10px; color: #ccc; margin-top: 10px;">ç´€éŒ„æ—¥æœŸ: ${item.date}</div>
            `;
            list.appendChild(div);
        });
    }

    function deleteRecord(id) {
        if(confirm('ç¢ºå®šåˆªé™¤æ­¤ç­†é¡¯ç¤ºï¼Ÿ')) {
            let records = JSON.parse(localStorage.getItem('myDrinkLogs') || '[]');
            records = records.filter(r => r.id !== id);
            localStorage.setItem('myDrinkLogs', JSON.stringify(records));
            displayRecords();
        }
    }
</script>

</body>
</html>